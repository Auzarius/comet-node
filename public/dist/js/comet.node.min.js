angular.module("comet",["app.routes","ngAnimate","authService","mainCtrl","userCtrl","userService","ticketCtrl","ticketService"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"./views/pages/home.html"}).when("/signin",{templateUrl:"./views/pages/login.html",controller:"mainController",controllerAs:"login"}).when("/feedback",{templateUrl:"./views/pages/feedback/all.html",controller:"feedbackController",controllerAs:"feedback"}).when("/feedback/:fb_id/edit",{templateUrl:"./views/pages/feedback/edit.html",controller:"feedbackEditController",controllerAs:"feedback"}).when("/forbidden",{templateUrl:"./views/pages/403.html"}).when("/users",{templateUrl:"./views/pages/users/all.html",controller:"userController",controllerAs:"user"}).when("/users/create",{templateUrl:"./views/pages/users/create.html",controller:"userCreateController",controllerAs:"user"}).when("/users/:user_id",{templateUrl:"./views/pages/users/edit.html",controller:"userEditController",controllerAs:"user"}).when("/profile",{templateUrl:"./views/pages/profile.html",controller:"userProfileController",controllerAs:"user"}).when("/tickets",{templateUrl:"./views/pages/tickets/all.html",controller:"ticketController",controllerAs:"ticket"}).when("/tickets/all",{templateUrl:"./views/pages/tickets/all.html",controller:"ticketAllController",controllerAs:"ticket"}).when("/tickets/recent",{templateUrl:"./views/pages/tickets/recent.html",controller:"ticketRecentController",controllerAs:"ticket"}).when("/tickets/create",{templateUrl:"./views/pages/tickets/create.html",controller:"ticketCreateController",controllerAs:"ticket"}).when("/tickets/:ticket_id/edit",{templateUrl:"./views/pages/tickets/edit.html",controller:"ticketEditController",controllerAs:"ticket"}).when("/tickets/:ticket_id",{templateUrl:"./views/pages/tickets/single.html",controller:"ticketViewController",controllerAs:"ticket"}).when("/events/:event_id/edit",{templateUrl:"./views/pages/events/edit.html",controller:"eventEditController",controllerAs:"event"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]),angular.module("mainCtrl",["angularMoment"]).controller("mainController",["$rootScope","$location","Auth",function(e,t,s){var n=this;n.loggedIn=s.isLoggedIn(),e.$on("$routeChangeStart",function(e){n.loggedIn=s.isLoggedIn(),n.loggedIn?(n.location=t.path(),s.getUser().then(function(e){n.user=e.data}),"/signin"==t.path()&&t.path("/")):"/"==t.path()||"/signin"==t.path()||t.path("/signin")}),e.$on("$routeChangeSuccess",function(){$("html, body").animate({scrollTop:0},200)}),n.doLogin=function(){n.processing=!0,n.error="",s.login(n.loginData.username,n.loginData.password).success(function(e){n.processing=!1,n.user=n.loginData.username,e.success?t.path("/"):n.error=e.message})},n.doLogout=function(){s.logout(),n.user=null,t.path("/signin")}}]),angular.module("ticketCtrl",["ticketService"]).controller("ticketController",["$scope","Ticket",function(e,t){var s=this;s.simpleSearch=!0,s.processing=!0,s.toggleAdvanced=function(){e.searchBox=null,e.advancedForm.$setPristine(),s.simpleSearch=!s.simpleSearch},t.active().success(function(e){0==e.success||null==e.data?s.tickets=null:s.tickets=e.data,s.processing=!1}).error(function(e){e&&(s.message=e),s.tickets=null,s.processing=!1}),s.deleteTicket=function(e){s.processing=!0,t["delete"](e).success(function(e){e.success&&t.active().success(function(e){s.tickets=e.data}),s.processing=!1,s.message=e.message})}}]).controller("ticketRecentController",["$scope","Ticket",function(e,t){var s=this;s.processing=!0,t.recent().success(function(e){0==e.success||null==e.data?s.tickets=null:s.tickets=e.data,s.processing=!1}).error(function(e){e&&(s.message=e),s.tickets=null,s.processing=!1})}]).controller("ticketAllController",["$scope","Ticket",function(e,t){var s=this;s.simpleSearch=!0,s.processing=!0,s.toggleAdvanced=function(){e.searchBox=null,e.advancedForm.$setPristine(),s.simpleSearch=!s.simpleSearch},t.all().success(function(e){0==e.success||null==e.data?s.tickets=null:s.tickets=e.data,s.processing=!1}),s.deleteTicket=function(e){s.processing=!0,t["delete"](e).success(function(e){e.success&&t.all().success(function(e){s.tickets=e.data}),s.processing=!1,s.message=e.message})}}]).controller("ticketCreateController",["$scope","Ticket",function(e,t){var s=this;s.saveTicket=function(){s.processing=!0,s.message="",t.create(s.ticketData).success(function(t){s.processing=!1,s.message=t.message,s.ticketData={},e.ticketform.$setPristine(),$("html, body").animate({scrollTop:0},200)})}}]).controller("ticketEditController",["$routeParams","Ticket",function(e,t){var s=this;t.get(e.ticket_id).success(function(e){s.ticketData=e.data}),s.saveTicket=function(){s.processing=!0,s.message="",t.update(e.ticket_id,s.ticketData).success(function(e){s.processing=!1,s.message=e.message,$("html, body").animate({scrollTop:0},200)})}}]).controller("ticketViewController",["$scope","$routeParams","$location","Ticket",function(e,t,s,n){var r=this;r.processing=!0,r.event_processing=!0,e.eventForm={},r.getTicket=function(e){n.get(e).success(function(e){r.ticket=e.data,r.processing=!1}).error(function(e){r.processing=!1,r.message=e})},r.getTicket(t.ticket_id),r.deleteTicket=function(e){r.processing=!0,n["delete"](e).success(function(e){r.processing=!1,e.success&&s.path("/tickets")})},r.getEvents=function(){n.event.get(t.ticket_id).success(function(e){r.events=e.data,r.event_processing=!1}).error(function(e){r.event_processing=!1,r.message=e})},r.getEvents(),r.addEvent=function(){r.event_processing=!0,r.message="",n.event.create(t.ticket_id,r.eventData).success(function(t){r.event_processing=!1,r.ticket.timespent+=r.eventData.timespent,r.eventData={},e.eventform.$setPristine(),r.message=t.message,r.getEvents()}).error(function(e){r.event_processing=!1,r.message=e.message})},r.deleteEvent=function(e){r.event_processing=!0,n.event["delete"](e).success(function(e){e.success&&r.getEvents(),r.getTicket(t.ticket_id),r.event_processing=!1,r.message=e.message}).error(function(e){r.event_processing=!1,r.message=e.message})}}]).controller("eventEditController",["$routeParams","Ticket",function(e,t){var s=this;s.eventData={},t.event.getOne(e.event_id).success(function(e){s.eventData=e.data}),s.saveEvent=function(){s.processing=!0,s.message="",t.event.update(s.eventData.id,s.eventData).success(function(e){s.processing=!1,s.message=e.message,$("html, body").animate({scrollTop:0},200)}).error(function(e){s.processing=!1,s.message=e.message})}}]).controller("feedbackController",["$scope","$location","Ticket",function(e,t,s){var n=this;n.comments={},n.processing=!0,n.getFeedback=function(){s.feedback.get().success(function(e){n.comments=e.data,n.processing=!1}).error(function(e){n.processing=!1,n.message=e})},n.getFeedback(),n.addComment=function(){n.processing=!0,n.message="",s.feedback.create(n.feedbackData).success(function(t){n.processing=!1,n.feedbackData={},e.commentform.$setPristine(),n.getFeedback(),n.message=t.message}).error(function(e){n.processing=!1,n.message=e.message})},n.deleteComment=function(e){n.processing=!0,s.feedback["delete"](e).success(function(e){e.success&&n.getFeedback(),n.processing=!1,n.message=e.message}).error(function(e){n.processing=!1,n.message=e.message})}}]).controller("feedbackEditController",["$routeParams","Ticket",function(e,t){var s=this;s.processing=!0,s.feedbackData={},t.feedback.getOne(e.fb_id).success(function(e){s.feedbackData=e.data,s.processing=!1}).error(function(e){s.processing=!1}),s.saveComment=function(){s.processing=!0,s.message="",t.feedback.update(s.feedbackData.id,s.feedbackData).success(function(e){s.processing=!1,s.message=e.message,$("html, body").animate({scrollTop:0},200)}).error(function(e){s.processing=!1,s.message=e.message})}}]),angular.module("userCtrl",["userService"]).controller("userController",["User",function(e){var t=this;t.processing=!0,e.all().success(function(e){0==e.success||null==e.data?t.users=null:t.users=e.data,t.processing=!1}).error(function(e){e&&(t.message=e),t.users=null,t.processing=!1}),t.deleteUser=function(s){t.processing=!0,t.users={},e["delete"](s).success(function(s){e.all().success(function(e){t.processing=!1,t.users=e.data,t.message="The user was successfully deleted!"})})}}]).controller("userCreateController",["$scope","User",function(e,t){var s=this;s.type="create",s.userData={},s.saveUser=function(){s.processing=!0,s.message="",t.create(s.userData).success(function(t){s.processing=!1,s.message=t.message,t.success&&(s.userData={},e.userform.$setPristine(),$("html, body").animate({scrollTop:0},200))})}}]).controller("userEditController",["$routeParams","User",function(e,t){var s=this;s.type="edit",t.get(e.user_id).success(function(e){s.userData=e.data}),s.saveUser=function(){s.processing=!0,s.message="",t.update(e.user_id,s.userData).success(function(e){s.processing=!1,s.message=e.message,$("html, body").animate({scrollTop:0},200)})}}]).controller("userProfileController",["$routeParams","User",function(e,t){var s=this;t.self().success(function(e){s.userData=e}),s.saveUser=function(){s.processing=!0,s.message="",t.update(s.userData.id,s.userData).success(function(e){s.processing=!1,s.message=e.message,$("html, body").animate({scrollTop:0},200)})}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,s){var n={};return n.login=function(t,n){return e.post("/api/authenticate",{username:t,password:n}).success(function(e){return s.setToken(e.token),e})},n.logout=function(){s.setToken()},n.isLoggedIn=function(){return!!s.getToken()},n.getUser=function(){return s.getToken()?e.get("/api/me",{cache:!1}):t.reject({message:"User has no token."})},n}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,s){var n={};return n.request=function(e){var t=s.getToken();return t&&(e.headers["x-access-token"]=t),e},n.responseError=function(n){return 401==n.status?(s.setToken(),t.path("/signin")):403==n.status&&t.path("/forbidden"),e.reject(n)},n}]),angular.module("ticketService",[]).factory("Ticket",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/tickets/"+t)},t.active=function(){return e.get("/api/tickets")},t.all=function(){return e.get("/api/tickets/all")},t.recent=function(){return e.get("/api/tickets/recent")},t.create=function(t){return e.post("/api/tickets/",t)},t.update=function(t,s){return e.put("/api/tickets/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/tickets/"+t)},t.event={get:function(t){return e.get("/api/tickets/"+t+"/events")},getOne:function(t){return e.get("/api/events/"+t)},create:function(t,s){return e.post("/api/tickets/"+t+"/events",s)},update:function(t,s){return e.put("/api/events/"+t,s)},"delete":function(t){return e["delete"]("/api/events/"+t)}},t.feedback={get:function(){return e.get("/api/feedback/")},getOne:function(t){return e.get("/api/feedback/"+t)},create:function(t){return e.post("/api/feedback/",t)},update:function(t,s){return e.put("/api/feedback/"+t,s)},"delete":function(t){return e["delete"]("/api/feedback/"+t)}},t}]),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.self=function(){return e.get("/api/me")},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,s){return e.put("/api/users/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]);
//# sourceMappingURL=comet.node.min.js.map
